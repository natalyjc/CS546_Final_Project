<div class="dashboard-container">
  <h2>Welcome, {{firstName}}!</h2>
  <p class="dashboard-intro">This is your personalized learning dashboard. Stay on top of your goals and progress!</p>

  {{#if isAdmin}}
  <a href="/admin" class="admin-link">Go to Admin Dashboard</a>
  {{/if}}

  <form action="/dashboard/preferences" method="POST" class="widget-settings-form">
    <label>
      <input type="checkbox" name="showCourses" {{#if dashboardPreferences.showCourses}}checked{{/if}}>
      ğŸ“š Show Courses
    </label>
    <label>
      <input type="checkbox" name="showGoals" {{#if dashboardPreferences.showGoals}}checked{{/if}}>
      ğŸ¯ Show Goals
    </label>
    <label>
      <input type="checkbox" name="showRecommendations" {{#if dashboardPreferences.showRecommendations}}checked{{/if}}>
      ğŸŒ Show Recommendations
    </label>
    <button type="submit">Save Preferences</button>
  </form>

  <div class="dashboard-grid">
    {{#if dashboardPreferences.showCourses}}
    <div class="resizable-box" style="width: {{layoutPrefs.courses.width}}; height: {{layoutPrefs.courses.height}}">
    <div class="dashboard-section">
      <div class="section-header">
        <h3>ğŸ“š My Courses</h3>
        <a href="/dashboard/courses/new" class="btn-create-course">â• Add New Course</a>
      </div>
      {{#if courses.length}}
      <ul class="course-list">
        {{#each courses}}
        <li class="course-card" data-course-id="{{this._id}}">
          <div class="course-card-header">
            <div class="course-name">{{this.title}}</div>
            <div class="course-actions">
              <form action="/dashboard/courses/delete/{{this._id}}" method="POST">
                <button type="submit" class="delete-course-btn">ğŸ—‘ Delete</button>
              </form>
            </div>
          </div>
          <div class="course-details">
            <span class="course-progress">ğŸ“ˆ Progress: {{this.progress}}%</span>
            <span class="course-status">ğŸ“Œ Status: {{this.status}}</span>
          </div>
          {{#if ../dashboardPreferences.showRecommendations}}
          <div class="course-recommendations">
            <h4>ğŸ¥ Recommended YouTube Videos:</h4>
            <ul><li>Loading videos...</li></ul>
          </div>
          {{/if}}
        </li>
        {{/each}}
      </ul>
      {{else}}
      <p>No courses added yet.</p>
      {{/if}}
    </div>
    </div>
    {{/if}}

    {{#if dashboardPreferences.showGoals}}
    <div class="resizable-box" style="width: {{layoutPrefs.goals.width}}; height: {{layoutPrefs.goals.height}}">
    <div class="dashboard-section">
      <div class="section-header">
        <h3>ğŸ¯ My Goals</h3>
        <a href="/dashboard/goals/new" class="btn-create-course">â• Add New Goal</a>
      </div>

      {{#if goals.length}}
      <ul class="goal-list">
        {{#each goals}}
          {{#if this.isCompleted}}
            <li class="goal-card completed-goal" style="display: none;">
              <div class="goal-text">ğŸ“Œ {{this.goalTitle}}</div>
              <div class="goal-target-date">ğŸ¯ Target Date: {{this.targetDate}}</div>
              <div class="goal-completed">âœ… Completed</div>
            </li>
          {{else}}
            <li class="goal-card">
              <div class="goal-card-content">
                <div class="goal-info">
                  <div class="goal-title">ğŸ“Œ {{this.goalTitle}}</div>
                  <div class="goal-date">ğŸ¯ Target Date: {{this.targetDate}}</div>
                </div>

                <div class="goal-status-actions">
                  {{#if this.isCompleted}}
                    <span class="goal-status completed">âœ… Completed</span>
                  {{else}}
                    <span class="goal-status in-progress">ğŸš€ In Progress</span>
                    <form action="/dashboard/goals/complete/{{this._id}}" method="POST">
                      <button type="submit" class="btn-primary mark-complete-btn">Mark as Completed</button>
                    </form>
                  {{/if}}
                </div>
              </div>
            </li>
          {{/if}}
        {{/each}}
      </ul>
      <button id="toggle-completed-btn" class="btn-create-course" style="margin-top: 1rem;">Show Completed Goals</button>
      {{else}}
      <p>No goals added yet.</p>
      {{/if}}
    </div>
    </div>
    {{/if}}
  </div>

  <form action="/logout" method="GET">
    <button type="submit" class="logout-btn">Logout</button>
  </form>
</div>

<script src="/js/recommendations.js"></script>
<script src="/js/goalsToggle.js"></script>
<script src="/js/dashboardresize.js"></script>